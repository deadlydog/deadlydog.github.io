<script>
(function () {
	var storageKey = 'theme-preference';
	var darkHref = '{{ '/assets/css/dark.css' | relative_url }}';
	var systemQuery = window.matchMedia('(prefers-color-scheme: dark)');
	var stored = null;
	var mode = 'system';

	try
	{
		stored = localStorage.getItem(storageKey);
		if (stored === 'dark' || stored === 'light')
		{
			mode = stored;
		}
	}
	catch (error)
	{
		mode = 'system';
	}

	var theme = mode === 'system' ? (systemQuery.matches ? 'dark' : 'light') : mode;
	var linkMedia = mode === 'system' ? '(prefers-color-scheme: dark)' : (theme === 'dark' ? 'all' : 'not all');
	var docEl = document.documentElement;

	docEl.dataset.theme = theme;
	docEl.dataset.themeMode = mode;

	if (theme === 'dark')
	{
		docEl.style.backgroundColor = '#0f172a';
		docEl.style.color = '#e5e7eb';
		docEl.style.colorScheme = 'dark';
	}
	else
	{
		docEl.style.backgroundColor = '#ffffff';
		docEl.style.color = '#111827';
		docEl.style.colorScheme = 'light';
	}

	var darkStylesheet = document.getElementById('theme-dark');

	if (!darkStylesheet)
	{
		darkStylesheet = document.createElement('link');
		darkStylesheet.id = 'theme-dark';
		darkStylesheet.rel = 'stylesheet';
		darkStylesheet.href = darkHref;
		document.head.appendChild(darkStylesheet);
	}

	darkStylesheet.media = linkMedia;
})();
</script>
